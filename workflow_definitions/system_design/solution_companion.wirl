workflow SolutionDesignCompanion {
  inputs {
    String chat_input
    String workspace_id
    String version_id
  }
  
  outputs {
    String final_version_id = SaveState.final_version_id?
  }

  node LoadWorkspace {
      call load_workspace_state
      inputs {
          String workspace_id = workspace_id
          String version_id = version_id
      }
      outputs {
         Record problem_space
         Record solution_space
      }
  }

  node GenerateCandidate {
      call generate_candidate
      inputs {
          Record problem_space = LoadWorkspace.problem_space
          Record solution_space = LoadWorkspace.solution_space?
      }
      const {
        model: "gemma3:27b"
      }
      outputs {
          Record candidate
      }
  }

  node CompareSolutions {
      call compare_solutions
      inputs {
          Record problem_space = LoadWorkspace.problem_space
          Record solution_space = LoadWorkspace.solution_space?
          Record candidate = GenerateCandidate.candidate
      }
      const {
        model: "gemma3:27b"
      }
      outputs {
          Record solution_space
      }
  }

  node SaveState {
      call save_state
      inputs {
          Record problem_space = LoadWorkspace.problem_space
          String workspace_id = workspace_id
          Record solution_space = CompareSolutions.solution_space
      }
      outputs {
          String final_version_id
      }
  }
}
